<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>ajax 在线校验工具</title>
<link rel="stylesheet" href="https://cdn.bootcss.com/twitter-bootstrap/3.4.1/css/bootstrap.min.css">
<style>
.container {
	margin-top: 10px;
}

#ajaxParams, #result {
	width: 100%;
	height: 380px;
	border: 1px solid #9e9e9e;
}

.clearfix:after {
	content: ".";
	display: block;
	height: 0;
	clear: both;
	visibility: hidden
}

.panel-title {
	margin-top: 8px;
}

.clearfix { *+
	height: 1%;
}

.l {
	float: left;
}

.r {
	float: right;
}

.mr10 {
	margin-right: 10px;
}

.mb15 {
	margin-bottom: 15px;
}

.pan {
	width: 50%;
	float: left;
}
</style>
</head>

<body>
	<div class="container">
		<div class="form-group">
			<label for="name">接口</label> <input type="text" class="form-control" id="interface" placeholder="请输入接口地址">
		</div>

		<div class="panel panel-default pan">
			<div class="panel-heading clearfix">
				<h3 class="panel-title l">请求参数</h3>
				<button type="button" class="btn btn-primary r" id="btn-request">发送请求</button>
				<button type="button" class="btn btn-primary r mr10" id="btn-beautify" style="display: none">format</button>
			</div>
			<div class="panel-body">
				<div id="ajaxParams"></div>
			</div>
		</div>

		<div class="panel panel-default pan">
			<div class="panel-heading" style="height: 55px">
				<h3 class="panel-title ">返回数据&nbsp;&nbsp;<span style="color:red" id="usetime"></span></h3>
			</div>
			<div class="panel-body">
				<div id="result"></div>
			</div>
		</div>
	</div>
	<form class="form-inline mb15" role="form" style="display: none">
		<div class="form-group mr10" style="width: 61%">
			<label class="sr-only" for="stream">base64</label> <input type="text" class="form-control" id="stream" placeholder="base64" style="width: 100%">
		</div>
		<div class="form-group">
			<input type="file" id="inputfile" accept="image/*">
		</div>
	</form>

	<script src="http://192.168.186.13/deploy/Commonlibs/jquery.min.js"></script>
	<script src="http://192.168.186.13/deploy/Commonlibs/beautify.min.js"></script>
	<script src="http://192.168.186.13/deploy/Commonlibs/ace.js"></script>
	<script>
      function getParam(paramName) {  
	    paramValue = "", isFound = !1;  
	    if (this.location.search.indexOf("?") == 0 && this.location.search.indexOf("=") > 1) {  
	        arrSource = unescape(this.location.search).substring(1, this.location.search.length).split("&"), i = 0;  
	        while (i < arrSource.length && !isFound) arrSource[i].indexOf("=") > 0 && arrSource[i].split("=")[0].toLowerCase() == paramName.toLowerCase() && (paramValue = arrSource[i].split("=")[1], isFound = !0), i++  
	    }  
	    return paramValue == "" && (paramValue = null), paramValue  
	}  
    var staticserverUrl = getParam('address');
	if (staticserverUrl=='' || staticserverUrl == null)
		staticserverUrl ="http://127.0.0.1:3334/intelligent_agent";
	staticserverUrl = staticserverUrl +"/chat";
	document.getElementById('interface').value = staticserverUrl;
	ace.edit('ajaxParams').setValue(js_beautify('{"input": "你好"}'),1);
  </script>

	<script>
    // assign 的 IE 兼容代码
    if (typeof Object.assign != 'function') {
      Object.defineProperty(Object, "assign", {
        value: function assign(target, varArgs) {
          'use strict';
          if (target == null) {
            throw new TypeError('Cannot convert undefined or null to object');
          }

          let to = Object(target);

          for (var index = 1; index < arguments.length; index++) {
            var nextSource = arguments[index];

            if (nextSource != null) {
              for (let nextKey in nextSource) {
                if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {
                  to[nextKey] = nextSource[nextKey];
                }
              }
            }
          }
          return to;
        },
        writable: true,
        configurable: true
      });
    }
  </script>

	<script>
  (function (ace, js_beautify) {
	  'use strict'
	  const ajaxParamsEditor = ace.edit('ajaxParams');
	  const resultEditor = ace.edit('result');
	  const interfaceEl = document.getElementById('interface');
	  const streamEl = document.getElementById('stream');

	  ajaxParamsEditor.setTheme('ace/theme/xcode');
	  ajaxParamsEditor.getSession().setMode("ace/mode/json");
	  ajaxParamsEditor.setFontSize(14);
	  ajaxParamsEditor.setOptions({
	    enableBasicAutocompletion: true,
	    enableSnippets: true,
	    enableLiveAutocompletion: true,
	    wrap:true
	  });

	  resultEditor.setTheme('ace/theme/xcode');
	  resultEditor.getSession().setMode("ace/mode/json");
	  resultEditor.setFontSize(14);
	  resultEditor.setOptions({
	    enableBasicAutocompletion: true,
	    enableSnippets: true,
	    enableLiveAutocompletion: true,
	    wrap:true
	  });

	  function initListener() {
	    document.getElementById('btn-request').addEventListener('click', function(){
		   var   params = eval('(' + ajaxParamsEditor.getValue() + ')');
			ace.edit('ajaxParams').setValue(js_beautify(JSON.stringify(params)),1);
	      request({
	        url: interfaceEl.value,
	        params: ajaxParamsEditor.getValue()
	      });
	    });
	  }
      var st = 0;
	  function request(_ref) {
		  var url = _ref.url,
		      params = _ref.params;

		  try {
		    JSON.parse(params);
		  } catch (error) {
		    params = JSON.stringify(eval('(' + params + ')'));
		  }
          document.getElementById('usetime').innerText ="";
          resultEditor.setValue("");
          st=new Date().getTime();
		  $.ajax({
		    url: url,
		    type: 'post',
		    data: params,
		    contentType: 'application/json',
		    dataType: 'json',
		    success: function success(response) {
            var st2=new Date().getTime() - st;
            document.getElementById('usetime').innerText ="用时:" + st2/1000.0+"s";
		      resultEditor.setValue(typeof response === 'string' ? response : js_beautify(JSON.stringify(response)), 1);
		    },
		    error: function error(_error) {
            var st2=new Date().getTime() - st;
            document.getElementById('usetime').innerText ="用时:" + st2/1000.0+"s";
		      resultEditor.setValue(js_beautify(JSON.stringify(_error)), 1);
		    }
		  });
		}

	  initListener();
	}(window.ace, window.js_beautify))
	</script>

</body>

</html>